<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRC API Testing Tool</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --success: #16a34a;
            --error: #dc2626;
            --warning: #ca8a04;
            --info: #0891b2;
            --neutral: #4b5563;
            --bg-light: #f9fafb;
            --border: #e5e7eb;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #1f2937;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8fafc;
        }
        
        /* Header styles */
        .header {
            padding: 20px 0;
            border-bottom: 2px solid var(--primary);
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: var(--primary);
            font-size: 2rem;
            font-weight: 700;
        }
        
        .header p {
            color: var(--neutral);
            margin-top: 10px;
        }
        
        /* Tabs and content */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            font-weight: 500;
            color: var(--neutral);
            background-color: transparent;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 4px;
            border-radius: 8px 8px 0 0;
            transition: all 0.2s ease;
        }
        
        .tab:hover {
            color: var(--primary);
            background-color: rgba(37, 99, 235, 0.05);
        }
        
        .tab.active {
            color: var(--primary);
            background-color: white;
            border-color: var(--border);
            border-bottom: 2px solid white;
            margin-bottom: -1px;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Card and panel components */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            overflow: hidden;
        }
        
        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            background-color: white;
        }
        
        .card-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
        }
        
        .card-body {
            padding: 20px;
        }
        
        /* Form elements */
        .form-group {
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
        }
        
        input[type="text"], 
        input[type="email"], 
        input[type="password"],
        select, 
        textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.15s ease;
        }
        
        input:focus, 
        select:focus, 
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* Button styles */
        .btn {
            display: inline-block;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            background-color: var(--primary);
            color: white;
            font-weight: 500;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            background-color: var(--primary-hover);
        }
        
        .btn-secondary {
            background-color: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .btn-secondary:hover {
            background-color: rgba(37, 99, 235, 0.05);
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }
        
        /* Checkbox and radio */
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
        }
        
        /* Response display */
        .response-container {
            margin-top: 24px;
        }
        
        .status {
            padding: 12px;
            border-radius: 6px;
            font-weight: 500;
            margin-bottom: 16px;
        }
        
        .status.success {
            background-color: rgba(22, 163, 74, 0.1);
            color: var(--success);
            border: 1px solid rgba(22, 163, 74, 0.2);
        }
        
        .status.error {
            background-color: rgba(220, 38, 38, 0.1);
            color: var(--error);
            border: 1px solid rgba(220, 38, 38, 0.2);
        }
        
        pre {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Image display */
        .image-preview {
            margin-top: 24px;
            text-align: center;
        }
        
        .image-preview img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 6px;
            border: 1px solid var(--border);
            padding: 4px;
            background: white;
        }
        
        /* Documentation section */
        .docs-section {
            background-color: #f8fafc;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 24px;
            border-left: 4px solid var(--info);
        }
        
        .docs-section h3 {
            color: var(--info);
            margin-bottom: 8px;
        }
        
        /* URL display */
        .url-display {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            background-color: #f1f5f9;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 16px;
            word-break: break-all;
        }
        
        /* Endpoint listing */
        .endpoint-list {
            list-style: none;
            margin-top: 16px;
        }
        
        .endpoint-list li {
            margin-bottom: 8px;
            padding-left: 24px;
            position: relative;
        }
        
        .endpoint-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--primary);
        }
        
        /* Method badges */
        .method {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }
        
        .method.get {
            background-color: rgba(8, 145, 178, 0.1);
            color: #0891b2;
        }
        
        .method.post {
            background-color: rgba(22, 163, 74, 0.1);
            color: #16a34a;
        }
        
        .method.put {
            background-color: rgba(202, 138, 4, 0.1);
            color: #ca8a04;
        }
        
        .method.delete {
            background-color: rgba(220, 38, 38, 0.1);
            color: #dc2626;
        }
        
        /* Collapsible sections */
        .collapsible {
            margin-top: 16px;
        }
        
        .collapsible-header {
            padding: 10px 16px;
            background-color: #f1f5f9;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }
        
        .collapsible-header:hover {
            background-color: #e2e8f0;
        }
        
        .collapsible-header:after {
            content: "+";
            font-size: 20px;
            color: var(--neutral);
        }
        
        .collapsible-header.active:after {
            content: "-";
        }
        
        .collapsible-content {
            display: none;
            padding: 16px;
            border: 1px solid #e2e8f0;
            border-top: none;
            border-radius: 0 0 6px 6px;
        }
        
        .collapsible-header.active + .collapsible-content {
            display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>VRC API Testing Suite</h1>
        <p>Công cụ kiểm thử API cho hệ thống VRC</p>
    </div>
    
    <div class="tabs">
        <div class="tab active" data-tab="company-info">Thông Tin Công Ty</div>
        <div class="tab" data-tab="contact-form">Form Liên Hệ</div>
        <div class="tab" data-tab="auth-test">Kiểm Tra Xác Thực</div>
        <div class="tab" data-tab="docs">Tài Liệu API</div>
    </div>
    
    <!-- COMPANY INFO API TAB -->
    <div class="tab-content active" id="company-info">
        <div class="card">
            <div class="card-header">
                <h2>Kiểm Tra API Thông Tin Công Ty</h2>
            </div>
            <div class="card-body">
                <div class="docs-section">
                    <h3>Thông tin API</h3>
                    <p>API này cung cấp thông tin về công ty, bao gồm tên, thông tin liên hệ, mạng xã hội và logo.</p>
                    <div class="url-display">
                        <span class="method get">GET</span> /api/globals/company-info (API chính thức)
                    </div>
                    <div class="url-display">
                        <span class="method get">GET</span> /api/company-info (API tùy chỉnh)
                    </div>
                </div>
                
                <div class="form-group">
                    <h3>Tùy chọn xác thực:</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="useToken">
                        <label for="useToken">Sử dụng Bearer Token</label>
                    </div>
                    <input type="text" id="bearerToken" placeholder="Nhập token ở đây" value="test-token">
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="useCookie">
                        <label for="useCookie">Sử dụng Cookie xác thực (khi đã đăng nhập vào admin)</label>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button id="fetchOfficialApi" class="btn">Lấy Dữ Liệu (API Chính Thức)</button>
                    <button id="fetchCustomApi" class="btn btn-secondary">Lấy Dữ Liệu (API Tùy Chỉnh)</button>
                </div>
                
                <div class="response-container">
                    <div id="companyInfoStatus" class="status"></div>
                    <h3>Kết quả:</h3>
                    <pre id="companyInfoResponse">Nhấn nút "Lấy Dữ Liệu" để xem kết quả...</pre>
                    
                    <div class="image-preview" id="logoContainer">
                        <h3>Logo Công Ty:</h3>
                        <p>(Chưa có logo)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- CONTACT FORM API TAB -->
    <div class="tab-content" id="contact-form">
        <div class="card">
            <div class="card-header">
                <h2>Kiểm Tra API Form Liên Hệ</h2>
            </div>
            <div class="card-body">
                <div class="docs-section">
                    <h3>Thông tin API</h3>
                    <p>API này cho phép gửi yêu cầu liên hệ từ người dùng vào hệ thống.</p>
                    <div class="url-display">
                        <span class="method post">POST</span> /api/contact
                    </div>
                </div>
                
                <form id="contactTestForm">
                    <div class="form-group">
                        <label for="name">Họ tên:</label>
                        <input type="text" id="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Số điện thoại:</label>
                        <input type="text" id="phone">
                    </div>
                    
                    <div class="form-group">
                        <label for="subject">Chủ đề:</label>
                        <select id="subject">
                            <option value="general">Tư vấn chung</option>
                            <option value="repair">Dịch vụ sửa chữa</option>
                            <option value="maintenance">Bảo trì thiết bị</option>
                            <option value="installation">Lắp đặt</option>
                            <option value="consulting">Tư vấn kỹ thuật</option>
                            <option value="other">Khác</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="messageText">Nội dung:</label>
                        <textarea id="messageText" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn">Gửi Yêu Cầu Liên Hệ</button>
                </form>
                
                <div class="response-container">
                    <div id="contactFormStatus" class="status"></div>
                    <h3>Kết quả:</h3>
                    <pre id="contactFormResponse">Gửi form để xem kết quả...</pre>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AUTHENTICATION TEST TAB -->
    <div class="tab-content" id="auth-test">
        <div class="card">
            <div class="card-header">
                <h2>Kiểm Tra Xác Thực</h2>
            </div>
            <div class="card-body">
                <div class="docs-section">
                    <h3>Mục đích kiểm tra</h3>
                    <p>Công cụ này giúp kiểm tra xem bạn có xác thực hợp lệ với API hay không, phục vụ cho việc gỡ lỗi khi gặp vấn đề với xác thực.</p>
                </div>
                
                <div>
                    <h3>Trạng thái xác thực hiện tại:</h3>
                    <button id="checkAuthStatus" class="btn">Kiểm Tra Xác Thực</button>
                    <div id="authStatus" class="status"></div>
                    <pre id="authResponse">Nhấn nút "Kiểm Tra Xác Thực" để xem kết quả...</pre>
                </div>
                
                <div class="collapsible">
                    <div class="collapsible-header">Thông tin cookie hiện tại</div>
                    <div class="collapsible-content">
                        <p>Các cookie hiện có trong trình duyệt của bạn:</p>
                        <pre id="cookieInfo"></pre>
                        <p><strong>Lưu ý:</strong> Vì lý do bảo mật, cookie HttpOnly (như session cookies) không thể xem bằng JavaScript.</p>
                    </div>
                </div>
                
                <div class="collapsible">
                    <div class="collapsible-header">Tạo xác thực mới</div>
                    <div class="collapsible-content">
                        <p>Đăng nhập vào Admin Panel của Payload CMS để tạo phiên xác thực mới:</p>
                        <div class="btn-group">
                            <a href="/admin" target="_blank" class="btn">Mở Admin Panel</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- DOCUMENTATION TAB -->
    <div class="tab-content" id="docs">
        <div class="card">
            <div class="card-header">
                <h2>Tài Liệu API</h2>
            </div>
            <div class="card-body">
                <h3>Các API Endpoint Có Sẵn</h3>
                <ul class="endpoint-list">
                    <li>
                        <span class="method get">GET</span> 
                        <strong>/api/globals/company-info</strong> - Lấy thông tin công ty (API chính thức)
                    </li>
                    <li>
                        <span class="method get">GET</span> 
                        <strong>/api/company-info</strong> - Lấy thông tin công ty (API tùy chỉnh)
                    </li>
                    <li>
                        <span class="method post">POST</span> 
                        <strong>/api/contact</strong> - Gửi yêu cầu liên hệ
                    </li>
                </ul>
                
                <div class="collapsible">
                    <div class="collapsible-header">API Company Info</div>
                    <div class="collapsible-content">
                        <h4>Mô tả</h4>
                        <p>API này cung cấp thông tin về công ty, bao gồm tên, thông tin liên hệ, mạng xã hội và logo.</p>
                        
                        <h4>Endpoint</h4>
                        <div class="url-display">GET /api/globals/company-info</div>
                        <div class="url-display">GET /api/company-info</div>
                        
                        <h4>Tham số</h4>
                        <p>Không có tham số URL.</p>
                        
                        <h4>Headers</h4>
                        <p><code>Authorization: Bearer {token}</code> - Tùy chọn, nếu API yêu cầu xác thực</p>
                        
                        <h4>Phản hồi</h4>
                        <pre>{
  "companyName": "VRC company",
  "companyShortName": "VRC",
  "companyDescription": "Mô tả về công ty",
  "contactSection": {
    "address": "123 Nguyễn Văn Linh, Quận 7, TP.HCM",
    "phone": "0123456789",
    "email": "contact@vrc.com",
    ...
  },
  "socialMedia": { ... },
  "maps": { ... },
  "logo": {
    "id": "media-id",
    "url": "/media/path-to-logo.jpg",
    ...
  },
  ...
}</pre>
                    </div>
                </div>
                
                <div class="collapsible">
                    <div class="collapsible-header">API Contact Form</div>
                    <div class="collapsible-content">
                        <h4>Mô tả</h4>
                        <p>API này cho phép gửi yêu cầu liên hệ từ người dùng vào hệ thống.</p>
                        
                        <h4>Endpoint</h4>
                        <div class="url-display">POST /api/contact</div>
                        
                        <h4>Body</h4>
                        <pre>{
  "name": "Tên người liên hệ",
  "email": "email@example.com",
  "phone": "0123456789", // Không bắt buộc
  "subject": "general", // Các giá trị: general, repair, maintenance, installation, consulting, other
  "message": "Nội dung tin nhắn"
}</pre>
                        
                        <h4>Phản hồi thành công</h4>
                        <pre>{
  "success": true,
  "message": "Yêu cầu liên hệ đã được gửi thành công",
  "submission": {
    "id": "submission-id",
    "createdAt": "2025-05-15T10:30:00.000Z"
  }
}</pre>
                        
                        <h4>Phản hồi lỗi</h4>
                        <pre>{
  "success": false,
  "message": "Thông báo lỗi cụ thể"
}</pre>
                    </div>
                </div>
                  <div class="collapsible">
                    <div class="collapsible-header">Xử lý lỗi CORS</div>
                    <div class="collapsible-content">
                        <h4>Vấn đề CORS phổ biến</h4>
                        <p>Khi gọi API từ một nguồn khác với nguồn của API, có thể gặp lỗi CORS (Cross-Origin Resource Sharing).</p>
                        
                        <h4>Lỗi khi mở file trực tiếp (file://)</h4>
                        <p>Lỗi phổ biến: <code>Access to fetch at 'file:///E:/api/globals/company-info' from origin 'null' has been blocked by CORS policy</code></p>
                        <p><strong>Nguyên nhân:</strong> Trình duyệt không cho phép các yêu cầu fetch từ một file HTML được mở trực tiếp (protocol file://).</p>
                        <p><strong>Giải pháp:</strong></p>
                        <ol>
                            <li>Đặt file test vào thư mục <code>backend/public</code> và truy cập qua http://localhost:3000/api-test.html</li>
                            <li>Sử dụng Live Server extension trong VS Code để chạy trên máy chủ đơn giản</li>
                            <li>Sao chép file vào thư mục gốc của backend và truy cập qua http://localhost:3000</li>
                        </ol>
                        
                        <h4>Giải pháp cho các lỗi CORS khác</h4>
                        <ol>
                            <li>Đảm bảo máy chủ API cấu hình CORS cho phép nguồn gốc của bạn</li>
                            <li>Gọi API thông qua đường dẫn tương đối (ví dụ: <code>/api/...</code>) khi frontend và backend cùng domain</li>
                            <li>Sử dụng proxy trong quá trình phát triển</li>
                        </ol>
                        
                        <h4>Cấu hình CORS trong Payload CMS</h4>
                        <p>Xem file <code>payload.config.ts</code> để biết cấu hình CORS hiện tại:</p>
                        <pre>cors: {
  origins: [
    'http://localhost:3000',  // Backend URL
    'http://localhost:5173',  // Frontend URL
    // Các domain khác
  ],
  headers: ['authorization', 'content-type', ...]
}</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
      <script>
        // Tab navigation
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });
        
        // Collapsible sections
        document.querySelectorAll('.collapsible-header').forEach(header => {
            header.addEventListener('click', () => {
                header.classList.toggle('active');
            });
        });
        
        // Check if running from file:// protocol and show warning
        const isFileProtocol = window.location.protocol === 'file:';
        
        if (isFileProtocol) {
            // Create a warning banner
            const warningBanner = document.createElement('div');
            warningBanner.style.backgroundColor = '#ffe5e5';
            warningBanner.style.color = '#d32f2f';
            warningBanner.style.padding = '16px';
            warningBanner.style.marginBottom = '20px';
            warningBanner.style.borderRadius = '4px';
            warningBanner.style.border = '1px solid #ffcdd2';
            warningBanner.innerHTML = `
                <h3 style="margin-top: 0;">⚠️ Cảnh báo: Không thể kết nối với API</h3>
                <p>File HTML đang được mở trực tiếp từ hệ thống file (${window.location.protocol}//), điều này ngăn cản việc gọi API do chính sách CORS của trình duyệt.</p>
                <p><strong>Các cách khắc phục:</strong></p>
                <ol>
                    <li>Mở file thông qua máy chủ web local (http://localhost:3000)</li>
                    <li>Đặt file này vào thư mục public của backend và truy cập qua URL: http://localhost:3000/api-test.html</li>
                    <li>Sử dụng extension Live Server trong VS Code để chạy file này trên một máy chủ web đơn giản</li>
                </ol>
            `;
            document.body.insertBefore(warningBanner, document.body.firstChild);
        }
        
        // API base URL - Use the server URL if specified, otherwise use relative path
        const API_BASE = isFileProtocol ? 'http://localhost:3000/api' : '/api';
        
        // Company Info API Test - Official API
        document.getElementById('fetchOfficialApi').addEventListener('click', async () => {
            await fetchCompanyInfo('globals/company-info');
        });
        
        // Company Info API Test - Custom API
        document.getElementById('fetchCustomApi').addEventListener('click', async () => {
            await fetchCompanyInfo('company-info');
        });
          // Shared function to fetch company info
        async function fetchCompanyInfo(endpoint) {
            const statusEl = document.getElementById('companyInfoStatus');
            const responseEl = document.getElementById('companyInfoResponse');
            const logoContainer = document.getElementById('logoContainer');
            
            statusEl.textContent = 'Đang lấy dữ liệu...';
            statusEl.className = 'status';
            
            try {
                // Check if we're on file protocol
                if (isFileProtocol) {
                    statusEl.textContent = 'Lỗi: Không thể gọi API từ giao thức file://';
                    statusEl.className = 'status error';
                    responseEl.textContent = 'Lỗi CORS: Trình duyệt ngăn chặn các yêu cầu API khi mở file HTML trực tiếp từ hệ thống file.\n\nVui lòng xem hướng dẫn khắc phục ở banner cảnh báo phía trên.';
                    return;
                }
                
                // Prepare headers
                const headers = new Headers();
                headers.append('Content-Type', 'application/json');
                
                // Add authentication if selected
                if (document.getElementById('useToken').checked) {
                    const token = document.getElementById('bearerToken').value;
                    headers.append('Authorization', `Bearer ${token}`);
                }
                
                // Display the full URL being called
                console.log(`Calling API: ${API_BASE}/${endpoint}`);
                
                // Make the request
                const response = await fetch(`${API_BASE}/${endpoint}`, {
                    method: 'GET',
                    headers: headers,
                    // Include credentials for cookie-based auth
                    credentials: document.getElementById('useCookie').checked ? 'include' : 'same-origin'
                });
                
                const data = await response.json();
                
                // Format the JSON with indentation for better readability
                responseEl.textContent = JSON.stringify(data, null, 2);
                
                if (response.ok) {
                    statusEl.textContent = 'Thành công! Đã lấy dữ liệu.';
                    statusEl.className = 'status success';
                    
                    // Display logo if available
                    if (data.logo && data.logo.url) {
                        logoContainer.innerHTML = `
                            <h3>Logo Công Ty:</h3>
                            <img src="${data.logo.url}" alt="Logo Công Ty">
                            <p>URL Logo: ${data.logo.url}</p>
                        `;
                    } else {
                        logoContainer.innerHTML = `
                            <h3>Logo Công Ty:</h3>
                            <p>Không tìm thấy logo trong dữ liệu</p>
                        `;
                    }
                } else {
                    statusEl.textContent = `Lỗi: ${data.message || 'Lỗi không xác định'}`;
                    statusEl.className = 'status error';
                    logoContainer.innerHTML = `
                        <h3>Logo Công Ty:</h3>
                        <p>Không thể tải logo do lỗi API</p>
                    `;
                }
            } catch (error) {
                statusEl.textContent = `Lỗi mạng: ${error.message}`;
                statusEl.className = 'status error';
                responseEl.textContent = error.toString();
                logoContainer.innerHTML = `
                    <h3>Logo Công Ty:</h3>
                    <p>Không thể tải logo do lỗi mạng</p>
                `;
            }
        }
          // Contact Form API Test
        document.getElementById('contactTestForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const statusEl = document.getElementById('contactFormStatus');
            const responseEl = document.getElementById('contactFormResponse');
            
            statusEl.textContent = 'Đang gửi form...';
            statusEl.className = 'status';
            
            try {
                // Check if we're on file protocol
                if (isFileProtocol) {
                    statusEl.textContent = 'Lỗi: Không thể gọi API từ giao thức file://';
                    statusEl.className = 'status error';
                    responseEl.textContent = 'Lỗi CORS: Trình duyệt ngăn chặn các yêu cầu API khi mở file HTML trực tiếp từ hệ thống file.\n\nVui lòng xem hướng dẫn khắc phục ở banner cảnh báo phía trên.';
                    return;
                }
                
                const formData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    subject: document.getElementById('subject').value,
                    message: document.getElementById('messageText').value
                };
                
                const response = await fetch(`${API_BASE}/contact`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                responseEl.textContent = JSON.stringify(data, null, 2);
                
                if (response.ok) {
                    statusEl.textContent = 'Thành công! Form đã được gửi.';
                    statusEl.className = 'status success';
                    document.getElementById('contactTestForm').reset();
                } else {
                    statusEl.textContent = `Lỗi: ${data.message || 'Lỗi không xác định'}`;
                    statusEl.className = 'status error';
                }
            } catch (error) {
                statusEl.textContent = `Lỗi mạng: ${error.message}`;
                statusEl.className = 'status error';
                responseEl.textContent = error.toString();
            }
        });
          // Authentication Test
        document.getElementById('checkAuthStatus').addEventListener('click', async () => {
            const statusEl = document.getElementById('authStatus');
            const responseEl = document.getElementById('authResponse');
            
            statusEl.textContent = 'Đang kiểm tra xác thực...';
            statusEl.className = 'status';
            
            try {
                // Check if we're on file protocol
                if (isFileProtocol) {
                    statusEl.textContent = 'Lỗi: Không thể gọi API từ giao thức file://';
                    statusEl.className = 'status error';
                    responseEl.textContent = 'Lỗi CORS: Trình duyệt ngăn chặn các yêu cầu API khi mở file HTML trực tiếp từ hệ thống file.\n\nVui lòng xem hướng dẫn khắc phục ở banner cảnh báo phía trên.';
                    return;
                }
                
                // Test with credentials included to check for cookie auth
                const response = await fetch(`${API_BASE}/globals/company-info`, {
                    credentials: 'include'
                });
                
                const data = await response.json();
                responseEl.textContent = JSON.stringify(data, null, 2);
                
                if (response.ok) {
                    statusEl.textContent = 'Xác thực thành công hoặc không yêu cầu xác thực';
                    statusEl.className = 'status success';
                } else if (response.status === 401) {
                    statusEl.textContent = 'Xác thực thất bại: Không được xác thực';
                    statusEl.className = 'status error';
                } else {
                    statusEl.textContent = `Lỗi: ${data.message || 'Lỗi không xác định'} (${response.status})`;
                    statusEl.className = 'status error';
                }
            } catch (error) {
                statusEl.textContent = `Lỗi mạng: ${error.message}`;
                statusEl.className = 'status error';
                responseEl.textContent = error.toString();
            }
            
            // Display cookie info (except HttpOnly cookies)
            document.getElementById('cookieInfo').textContent = document.cookie || '(Không tìm thấy cookie non-HttpOnly)';
        });
        
        // Initialize cookie info on page load
        document.getElementById('cookieInfo').textContent = document.cookie || '(Không tìm thấy cookie non-HttpOnly)';
    </script>
</body>
</html>
